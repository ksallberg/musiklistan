<html>

<head>
     <link href="hacker.css" rel="stylesheet">
</head>

<body>

<img src="piano_cat.jpg" width="40%" height="40%"/>
<br/>

<erl>

%-record(usercookie, {username, times=0}).
-include("common.hrl").

add_link({Id, Name}) ->
    "<tr>" ++
    "<td><a href=\"pl.yaws?list="++Id++"\">" ++ Name ++ "</a></td>" ++
    "<td><a href=\"pl2.yaws?list="++Id++"\">Simpel vy</a></td>" ++
    "<td><a href=\"share_pl.yaws?list="++Id++"\">Dela listan</a></td>"
    ++ "</tr>".

out(A) ->
    H = A#arg.headers,
    C = H#headers.cookie,
    case yaws_api:find_cookie_val("usersession", C) of
        [] -> {html, "You need to log in!"};
        Cookie ->
            case yaws_api:cookieval_to_opaque(Cookie) of
                {ok, OP} ->
                    Username = OP#usercookie.username,
                    Lists    = musiklistan:playlists_get(Username),
                    FLists = lists:foldl(fun(List, Acc) ->
                                             Acc ++ add_link(List)
                                         end,
                                         "<table>",
                                         Lists),
                    {html, Username ++ ", you are logged in.<br/>" ++
                           "<h1>Lists:</h1>" ++ FLists ++ "</table>"};
                {error, no_session} ->
                    {html, "Not logged in..."}
            end
    end.

</erl>

     <form method="post" action="playlists_post.yaws">
     <h1>Add list</h1>
        Playlist name:
        <br/>
        <input name="playlist_name" type="text"/>
        <br/>
        <input type="submit"/>
    </form>
</body>

<a href="logout.yaws">Logga ut...</a>

</html>
